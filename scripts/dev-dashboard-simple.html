<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AstaVerde Dev Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            color: #333;
            margin-bottom: 30px;
            font-size: 2rem;
        }
        
        .status-bar {
            background: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 30px;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .card h2 {
            font-size: 1.1rem;
            margin-bottom: 15px;
            color: #666;
        }
        
        .mint-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .mint-slider {
            flex: 1;
            height: 4px;
            background: #e0e0e0;
            border-radius: 2px;
            outline: none;
            -webkit-appearance: none;
        }
        
        .mint-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: #667eea;
            border-radius: 50%;
            cursor: pointer;
        }
        
        .mint-count {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
            min-width: 30px;
            text-align: center;
        }
        
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.95rem;
            transition: background 0.2s;
        }
        
        button:hover {
            background: #5a67d8;
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .button-row {
            display: flex;
            gap: 10px;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .info-item {
            display: flex;
            flex-direction: column;
        }
        
        .info-label {
            font-size: 0.85rem;
            color: #999;
            margin-bottom: 4px;
        }
        
        .info-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
        }
        
        .accounts-grid {
            display: grid;
            gap: 10px;
        }
        
        .account-row {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        .account-name {
            font-weight: 600;
        }
        
        .balances {
            display: flex;
            gap: 15px;
            color: #666;
        }
        
        .console {
            background: #1a1a1a;
            color: #0f0;
            font-family: 'Courier New', monospace;
            padding: 15px;
            border-radius: 8px;
            height: 200px;
            overflow-y: auto;
            font-size: 0.85rem;
        }
        
        .console-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .clear-btn {
            background: transparent;
            color: #666;
            border: 1px solid #ddd;
            padding: 5px 10px;
            font-size: 0.85rem;
        }
        
        .clear-btn:hover {
            background: #f5f5f5;
        }
        
        .help-text {
            color: #999;
            font-size: 0.85rem;
            margin-top: 5px;
        }
        
        .external-link {
            color: #667eea;
            text-decoration: none;
        }
        
        .external-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ AstaVerde Dev Dashboard</h1>
        
        <div class="status-bar">
            <div class="status-item">
                <div class="status-dot"></div>
                <span>Connected to Local Node</span>
            </div>
            <div class="status-item">
                <span>Block: <strong id="block-number">-</strong></span>
            </div>
            <div class="status-item">
                <span>Batch #<strong id="batch-id">-</strong></span>
            </div>
            <div class="status-item">
                <span>Price: <strong id="current-price">-</strong> USDC</span>
            </div>
        </div>
        
        <div class="main-grid">
            <!-- Quick Actions -->
            <div class="card">
                <h2>Quick Actions</h2>
                
                <div class="mint-controls">
                    <span>Mint</span>
                    <input type="range" class="mint-slider" id="mint-slider" min="1" max="10" value="3" oninput="updateMintCount()">
                    <span class="mint-count" id="mint-count">3</span>
                    <span>NFTs</span>
                </div>
                
                <div class="button-row">
                    <button onclick="mintBatch()" id="mint-btn">üé® Mint Batch</button>
                    <button onclick="runTestFlow()" id="flow-btn">‚ñ∂Ô∏è Run Test Flow</button>
                </div>
                
                <p class="help-text">
                    Test flow: Buy NFT ‚Üí Deposit to Vault ‚Üí Get SCC ‚Üí Withdraw
                </p>
            </div>
            
            <!-- Current State -->
            <div class="card">
                <h2>Current State</h2>
                
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">Total NFTs</span>
                        <span class="info-value" id="total-nfts">9</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">SCC Supply</span>
                        <span class="info-value" id="scc-supply">0</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Vault Deposits</span>
                        <span class="info-value" id="vault-deposits">0</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Active Users</span>
                        <span class="info-value" id="active-users">1</span>
                    </div>
                </div>
                
                <div class="button-row">
                    <button onclick="refreshAll()">üîÑ Refresh</button>
                    <a href="http://localhost:3000" target="_blank" class="external-link">
                        <button>üåê Open Webapp</button>
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Test Accounts -->
        <div class="card">
            <div class="console-header">
                <h2>Test Accounts</h2>
                <button onclick="checkAllBalances()" class="clear-btn">Refresh Balances</button>
            </div>
            
            <div class="accounts-grid" id="accounts-grid">
                <div class="account-row">
                    <span class="account-name">Deployer</span>
                    <div class="balances">
                        <span>9999 ETH</span>
                        <span>99931 USDC</span>
                        <span>0 SCC</span>
                    </div>
                </div>
                <div class="account-row">
                    <span class="account-name">Alice</span>
                    <div class="balances">
                        <span>10000 ETH</span>
                        <span>100000 USDC</span>
                        <span>0 SCC</span>
                    </div>
                </div>
                <div class="account-row">
                    <span class="account-name">Bob</span>
                    <div class="balances">
                        <span>10000 ETH</span>
                        <span>100000 USDC</span>
                        <span>0 SCC</span>
                    </div>
                </div>
            </div>
            
            <p class="help-text">
                All test accounts have private keys available in the console output
            </p>
        </div>
        
        <!-- Console -->
        <div class="card">
            <div class="console-header">
                <h2>Console</h2>
                <button onclick="clearConsole()" class="clear-btn">Clear</button>
            </div>
            <div class="console" id="console">Ready...</div>
        </div>
    </div>
    
    <script>
        const API_URL = 'http://localhost:8080';
        let autoRefresh = null;
        
        // Simple logging
        function log(message, type = 'info') {
            const console = document.getElementById('console');
            const time = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? '[ERROR]' : type === 'success' ? '[OK]' : '[INFO]';
            console.textContent += `\n${time} ${prefix} ${message}`;
            console.scrollTop = console.scrollHeight;
        }
        
        // Clear console
        function clearConsole() {
            document.getElementById('console').textContent = 'Console cleared.\n';
        }
        
        // Update mint count
        function updateMintCount() {
            document.getElementById('mint-count').textContent = document.getElementById('mint-slider').value;
        }
        
        // API helper
        async function api(endpoint, options = {}) {
            try {
                const response = await fetch(API_URL + endpoint, options);
                return await response.json();
            } catch (error) {
                log(`API error: ${error.message}`, 'error');
                throw error;
            }
        }
        
        // Update status
        async function updateStatus() {
            try {
                const status = await api('/api/status');
                document.getElementById('block-number').textContent = status.blockNumber || '-';
                
                const batchInfo = await api('/api/batch-info');
                document.getElementById('batch-id').textContent = batchInfo.lastBatchId || '-';
                document.getElementById('current-price').textContent = batchInfo.currentPrice?.replace(' USDC', '') || '-';
                document.getElementById('total-nfts').textContent = batchInfo.lastTokenId || '0';
                
                const vaultStats = await api('/api/vault-stats');
                document.getElementById('scc-supply').textContent = parseFloat(vaultStats.totalSCC || 0).toFixed(0);
                document.getElementById('vault-deposits').textContent = vaultStats.totalDeposits || '0';
            } catch (error) {
                // Silent fail for status updates
            }
        }
        
        // Mint batch
        async function mintBatch() {
            const btn = document.getElementById('mint-btn');
            btn.disabled = true;
            const count = document.getElementById('mint-slider').value;
            
            log(`Minting ${count} NFTs...`);
            
            try {
                const result = await api('/api/mint', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ count: parseInt(count) })
                });
                
                if (result.success) {
                    log(`Minted ${count} NFTs successfully!`, 'success');
                    setTimeout(updateStatus, 1000);
                } else {
                    log(`Mint failed: ${result.error}`, 'error');
                }
            } catch (error) {
                log(`Mint failed: ${error.message}`, 'error');
            } finally {
                btn.disabled = false;
            }
        }
        
        // Run test flow
        async function runTestFlow() {
            const btn = document.getElementById('flow-btn');
            btn.disabled = true;
            
            log('Starting test flow: Buy ‚Üí Deposit ‚Üí Withdraw ‚Üí Redeem');
            
            try {
                const result = await api('/api/test-flow', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });
                
                if (result.success) {
                    log('Test flow completed successfully!', 'success');
                    setTimeout(() => {
                        updateStatus();
                        checkAllBalances();
                    }, 2000);
                } else {
                    log(`Test flow failed: ${result.error}`, 'error');
                }
            } catch (error) {
                log(`Test flow failed: ${error.message}`, 'error');
            } finally {
                btn.disabled = false;
            }
        }
        
        // Check all balances
        async function checkAllBalances() {
            log('Updating account balances...');
            
            const accounts = [
                { name: 'Deployer', address: '0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266' },
                { name: 'Alice', address: '0x70997970C51812dc3A010C7d01b50e0d17dc79C8' },
                { name: 'Bob', address: '0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC' }
            ];
            
            const grid = document.getElementById('accounts-grid');
            grid.innerHTML = '';
            
            for (const account of accounts) {
                try {
                    const balances = await api(`/api/balance/${account.address}`);
                    
                    const row = document.createElement('div');
                    row.className = 'account-row';
                    row.innerHTML = `
                        <span class="account-name">${account.name}</span>
                        <div class="balances">
                            <span>${parseFloat(balances.eth || 0).toFixed(0)} ETH</span>
                            <span>${parseFloat(balances.usdc || 0).toFixed(0)} USDC</span>
                            <span>${parseFloat(balances.scc || 0).toFixed(0)} SCC</span>
                        </div>
                    `;
                    grid.appendChild(row);
                } catch (error) {
                    // Skip failed balance checks
                }
            }
            
            log('Balances updated', 'success');
        }
        
        // Refresh all
        function refreshAll() {
            log('Refreshing all data...');
            updateStatus();
            checkAllBalances();
        }
        
        // Initialize
        async function init() {
            log('Dashboard initialized');
            updateStatus();
            checkAllBalances();
            
            // Auto-refresh every 5 seconds
            autoRefresh = setInterval(updateStatus, 5000);
        }
        
        // Start
        window.addEventListener('load', init);
    </script>
</body>
</html>